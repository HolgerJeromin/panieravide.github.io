<!DOCTYPE html5>
<html>
<!--
	This file is part of YoHours.

	YoHours is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	any later version.

	YoHours is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with YoHours. If not, see <http://www.gnu.org/licenses/>.
-->
<!--
	YoHours
	Web interface to make opening hours data for OpenStreetMap the easy way
	Author: Adrien PAVIE
	
	Test runner page
-->
<head>
	<!-- General definitions -->
	<title>YoHours (Test page)</title>
	<meta charset="utf-8" />

	<!-- jQuery includes -->
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	
	<!-- FullCalendar includes -->
	<script src="lib/moment.js"></script>
	<link rel='stylesheet' href='lib/fullcalendar/fullcalendar.css' />
	<script src='lib/fullcalendar/fullcalendar.js'></script>
	
	<!-- opening_hours.js includes -->
	<script src="lib/opening_hours.js"></script>
	
	<!-- QUnit includes -->
	<link rel="stylesheet" href="//code.jquery.com/qunit/qunit-1.18.0.css">
	<script src="//code.jquery.com/qunit/qunit-1.18.0.js"></script>
	
	<!-- YoHours includes -->
	<script type="text/javascript">
		YoHours = function() {};
	</script>
	<script src="js/utils.js" type="text/javascript"></script>
	<script src="js/model.js" type="text/javascript"></script>
	<script src="js/view.js" type="text/javascript"></script>
	<script src="js/controller.js" type="text/javascript"></script>
	
	<!-- Tests -->
	<script>
		/*
		 * Model
		 */
		
		//Interval
		QUnit.module("Model > Interval");
		QUnit.test("Constructor", function(assert) {
			assert.ok(new YoHours.model.Interval(0,0,0,60));
		});
		QUnit.test("Basic", function(assert) {
			var interval = new YoHours.model.Interval(0,1,2,3);
			assert.equal(interval.getStartDay(), 0);
			assert.equal(interval.getEndDay(), 1);
			assert.equal(interval.getFrom(), 2);
			assert.equal(interval.getTo(), 3);
		});
		QUnit.test("End as monday midnight", function(assert) {
			var interval = new YoHours.model.Interval(5,0,60,0);
			assert.equal(interval.getStartDay(), 5);
			assert.equal(interval.getEndDay(), 6);
			assert.equal(interval.getFrom(), 60);
			assert.equal(interval.getTo(), 24*60);
		});
		
		//Day
		QUnit.module("Model > Day");
		QUnit.test("Constructor", function(assert) {
			assert.ok(new YoHours.model.Day());
		});
		QUnit.test("Minutes array", function(assert) {
			var day = new YoHours.model.Day();
			day.addInterval(new YoHours.model.Interval(0, 0, 60, 120));
			
			var minutes = day.getAsMinutesArray();
			assert.equal(minutes.length, 24*60+1);
			for(var m=0; m <= 24*60; m++) {
				if(m >= 60 && m <= 120) {
					assert.ok(minutes[m]);
				}
				else {
					assert.notOk(minutes[m]);
				}
			}
		});
		QUnit.test("Raw intervals", function(assert) {
			var day = new YoHours.model.Day();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(0, 0, 360, 420);
			var it3 = new YoHours.model.Interval(0, 0, 660, 720);
			
			var itId1 = day.addInterval(it1);
			var itId2 = day.addInterval(it2);
			var itId3 = day.addInterval(it3);
			
			//Check without deleting
			var intervals = day.getIntervals(false);
			assert.equal(intervals[itId1], it1);
			assert.equal(intervals[itId2], it2);
			assert.equal(intervals[itId3], it3);
			
			//Check with deleting
			day.removeInterval(itId2);
			var intervals2 = day.getIntervals(false);
			assert.equal(intervals[itId1], it1);
			assert.equal(intervals[itId2], undefined);
			assert.equal(intervals[itId3], it3);
		});
		QUnit.test("Cleaned intervals", function(assert) {
			var day = new YoHours.model.Day();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(0, 0, 120, 300);
			var it3 = new YoHours.model.Interval(0, 0, 660, 720);
			
			var itId1 = day.addInterval(it1);
			var itId2 = day.addInterval(it2);
			var itId3 = day.addInterval(it3);
			
			//Check without deleting
			var intervals = day.getIntervals(true);
			assert.equal(intervals.length, 2);
			var resIt1 = intervals[0];
			assert.equal(resIt1.getStartDay(), 0);
			assert.equal(resIt1.getEndDay(), 0);
			assert.equal(resIt1.getFrom(), 60);
			assert.equal(resIt1.getTo(), 300);
			
			var resIt2 = intervals[1];
			assert.equal(resIt2.getStartDay(), 0);
			assert.equal(resIt2.getEndDay(), 0);
			assert.equal(resIt2.getFrom(), 660);
			assert.equal(resIt2.getTo(), 720);
			
			//Check with deleting
			day.removeInterval(itId2);
			var intervals2 = day.getIntervals(true);
			assert.equal(intervals2.length, 2);
			var res2It1 = intervals2[0];
			assert.equal(res2It1.getStartDay(), 0);
			assert.equal(res2It1.getEndDay(), 0);
			assert.equal(res2It1.getFrom(), 60);
			assert.equal(res2It1.getTo(), 120);
			
			var res2It2 = intervals2[1];
			assert.equal(res2It2.getStartDay(), 0);
			assert.equal(res2It2.getEndDay(), 0);
			assert.equal(res2It2.getFrom(), 660);
			assert.equal(res2It2.getTo(), 720);
		});
		QUnit.test("Edit intervals", function(assert) {
			var day = new YoHours.model.Day();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(0, 0, 360, 420);
			var it3 = new YoHours.model.Interval(0, 0, 660, 720);
			var it4 = new YoHours.model.Interval(0, 0, 664, 724);
			
			var itId1 = day.addInterval(it1);
			var itId2 = day.addInterval(it2);
			var itId3 = day.addInterval(it3);
			
			//Edit
			day.editInterval(itId2, it4);
			
			//Check
			var intervals = day.getIntervals(false);
			assert.equal(intervals[itId1], it1);
			assert.equal(intervals[itId2], it4);
			assert.equal(intervals[itId3], it3);
		});
		QUnit.test("Copy intervals", function(assert) {
			var day1 = new YoHours.model.Day();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(0, 0, 360, 420);
			
			var itId1 = day1.addInterval(it1);
			var itId2 = day1.addInterval(it2);
			
			var day2 = new YoHours.model.Day();
			day2.copyIntervals(day1.getIntervals(false));
			
			//Check
			var intervals = day2.getIntervals(false);
			var resIt1 = intervals[0];
			assert.equal(resIt1.getStartDay(), 0);
			assert.equal(resIt1.getEndDay(), 0);
			assert.equal(resIt1.getFrom(), 60);
			assert.equal(resIt1.getTo(), 120);
			
			var resIt2 = intervals[1];
			assert.equal(resIt2.getStartDay(), 0);
			assert.equal(resIt2.getEndDay(), 0);
			assert.equal(resIt2.getFrom(), 360);
			assert.equal(resIt2.getTo(), 420);
			
		});
		QUnit.test("Clear intervals", function(assert) {
			var day = new YoHours.model.Day();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(0, 0, 360, 420);
			var it3 = new YoHours.model.Interval(0, 0, 660, 720);
			
			var itId1 = day.addInterval(it1);
			var itId2 = day.addInterval(it2);
			var itId3 = day.addInterval(it3);
			
			//Check before
			var intervals = day.getIntervals(false);
			assert.equal(intervals.length, 3);
			
			day.clearIntervals();
			
			//Check after
			var intervals2 = day.getIntervals(false);
			assert.equal(intervals2.length, 0);
		});

		//Week
		QUnit.module("Model > Week");
		QUnit.test("Constructor", function(assert) {
			assert.ok(new YoHours.model.Week());
		});
		QUnit.test("Minutes array", function(assert) {
			var week = new YoHours.model.Week();
			week.addInterval(new YoHours.model.Interval(0, 0, 60, 120));
			week.addInterval(new YoHours.model.Interval(1, 2, 60, 120));
			
			var minutes = week.getAsMinutesArray();
			assert.equal(minutes.length, 7);
			for(var d=0; d < 7; d++) {
				assert.equal(minutes[d].length, 24*60+1);
				for(var m=0; m <= 24*60; m++) {
					if(d == 0) {
						if(m >= 60 && m <= 120) {
							assert.ok(minutes[d][m]);
						}
						else {
							assert.notOk(minutes[d][m]);
						}
					}
					else if(d==1) {
						if(m >= 60) {
							assert.ok(minutes[d][m]);
						}
						else {
							assert.notOk(minutes[d][m]);
						}
					}
					else if(d==2) {
						if(m <= 120) {
							assert.ok(minutes[d][m]);
						}
						else {
							assert.notOk(minutes[d][m]);
						}
					}
					else {
						assert.notOk(minutes[d][m]);
					}
				}
			}
		});
		QUnit.test("Raw intervals", function(assert) {
			var week = new YoHours.model.Week();
			
			var it1 = new YoHours.model.Interval(0, 0, 60, 120);
			var it2 = new YoHours.model.Interval(1, 2, 360, 420);
			var it3 = new YoHours.model.Interval(5, 6, 660, 720);
			
			var itId1 = week.addInterval(it1);
			var itId2 = week.addInterval(it2);
			var itId3 = week.addInterval(it3);
			
			//Check without deleting
			var intervals = week.getIntervals(false);
			assert.equal(intervals[itId1], it1);
			assert.equal(intervals[itId2], it2);
			assert.equal(intervals[itId3], it3);
			
			//Check with deleting
			week.removeInterval(itId2);
			var intervals2 = week.getIntervals(false);
			assert.equal(intervals[itId1], it1);
			assert.equal(intervals[itId2], undefined);
			assert.equal(intervals[itId3], it3);
		});

	</script>
</head>
<body>
	<div id="qunit"></div>
</body>
</html>